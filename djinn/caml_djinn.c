/* automatically generated by ocaml-bindgen 0.0.1 */

#include "djinn_export.h"
#include <caml/alloc.h>
#include <caml/callback.h>
#include <caml/fail.h>
#include <caml/memory.h>
#include <caml/mlvalues.h>
#include <caml/unixsupport.h>
void caml_djinn_try_init() {
  CAMLparam0();
  djinn_try_init();
  CAMLreturn0;
}

void caml_frame_begin() {
  CAMLparam0();
  frame_begin();
  CAMLreturn0;
}

void caml_frame_end() {
  CAMLparam0();
  frame_end();
  CAMLreturn0;
}

bool caml_window_should_close() {
  CAMLparam0();
  CAMLlocal1(result);
  result = window_should_close();
  CAMLreturn(result);
}

value caml_box_params_of_value(value caml_x) {
  CAMLparam1(caml_x);
  box_params* x = malloc(sizeof(struct box_params));
  x->x = Int_val(Field(caml_x, 0));
  x->y = Int_val(Field(caml_x, 1));
  x->width = Int_val(Field(caml_x, 2));
  x->height = Int_val(Field(caml_x, 3));
  x->r = Double_val(Field(caml_x, 4));
  x->g = Double_val(Field(caml_x, 5));
  x->b = Double_val(Field(caml_x, 6));
  CAMLreturn(caml_copy_nativeint(x));
}

value caml_box_params_to_value(struct box_params* x) {
  CAMLparam0();
  CAMLlocal1(caml_x);
  caml_x = caml_alloc_tuple(7);
  Store_field(caml_x, 0, Val_int(x->x));
  Store_field(caml_x, 1, Val_int(x->y));
  Store_field(caml_x, 2, Val_int(x->width));
  Store_field(caml_x, 3, Val_int(x->height));
  Store_field(caml_x, 4, caml_copy_double(x->r));
  Store_field(caml_x, 5, caml_copy_double(x->g));
  Store_field(caml_x, 6, caml_copy_double(x->b));
  CAMLreturn(caml_x);
}

text_params* caml_text_params_of_value(value caml_x) {
  text_params* x = malloc(sizeof(struct text_params));
  x->x = Int_val(Field(caml_x, 0));
  x->y = Int_val(Field(caml_x, 1));
  x->r = Double_val(Field(caml_x, 2));
  x->g = Double_val(Field(caml_x, 3));
  x->b = Double_val(Field(caml_x, 4));
  return x;
}

value caml_text_params_to_value(struct text_params* x) {
  CAMLparam0();
  CAMLlocal1(caml_x);
  caml_x = caml_alloc_tuple(5);
  Store_field(caml_x, 0, Val_int(x->x));
  Store_field(caml_x, 1, Val_int(x->y));
  Store_field(caml_x, 2, caml_copy_double(x->r));
  Store_field(caml_x, 3, caml_copy_double(x->g));
  Store_field(caml_x, 4, caml_copy_double(x->b));
  CAMLreturn(caml_x);
}

void caml_draw_rectangle(value caml_params) {
  CAMLparam1(caml_params);
  box_params* params = Nativeint_val(Field(caml_params, 1));
  draw_rectangle(params);
  CAMLreturn0;
}

void caml_draw_text_string(value caml_params) {
  CAMLparam1(caml_params);
  text_params* params = Nativeint_val(Field(caml_params, 1));
  draw_text_string(params);
  CAMLreturn0;
}

void caml_draw_text_str(value caml_contents, value caml_x, value caml_y) {
  CAMLparam3(caml_contents, caml_x, caml_y);
  int x = Int_val(caml_x);
  int y = Int_val(caml_y);
  char* contents = Nativeint_val(Field(caml_contents, 1));
  // printf("Test %s\n", contents);
  draw_text_str(x, y, contents);
  CAMLreturn0;
}

int caml_get_mouse_x() {
  CAMLparam0();
  CAMLlocal1(result);
  result = get_mouse_x();
  CAMLreturn(result);
}

int caml_get_mouse_y() {
  CAMLparam0();
  CAMLlocal1(result);
  result = get_mouse_y();
  CAMLreturn(result);
}

bool caml_get_left_btn() {
  CAMLparam0();
  CAMLlocal1(result);
  result = get_left_btn();
  CAMLreturn(result);
}

bool caml_get_prev_left_btn() {
  CAMLparam0();
  CAMLlocal1(result);
  result = get_prev_left_btn();
  CAMLreturn(result);
}


#include <stdlib.h>
value bindgen_alloc(value caml_size) {
    CAMLparam1(caml_size);

    // Convert OCaml integer to C size
    size_t size = Int_val(caml_size);
    printf("Allocated size %ld \n", size);

    void* ptr = malloc(sizeof(size));
    if (ptr == NULL) {
        // TODO: handle allocation failure
        CAMLreturn(Val_unit);
    }
    
    // Wrap the pointer as an OCaml value
    CAMLreturn(caml_copy_nativeint(ptr));
}

void bindgen_free(value caml_addr) {
    free(Nativeint_val(caml_addr));
}

value bindgen_alloc_string(value caml_string) {
  CAMLparam1(caml_string);
    char* str = String_val(caml_string);
    CAMLreturn(caml_copy_nativeint((intnat)str));
}
